import{c as d,o,a as n,t as p,F as v,g as w,_ as m,u,b as c,d as f,v as F,f as y,r as D,w as k,e as j,h as N,l as h,x as I,i as A,j as B,k as M,y as q,m as O,n as E,z as T,p as x,q as U,s as L}from"./index.es-CT6wA16L.js";/* empty css                   */const P={class:"name-list"},J={class:"name-list-ul"},R=["onClick"],H={name:"StudentMenu",props:{students:{required:!0,default:[{fname:"Joost",id:9999}],type:Array},current:{required:!0,default:{fname:"Joost",id:9999},type:Object}}},S=Object.assign(H,{setup(t){const e=s=>{localStorage.setItem("student",s),window.location.href=`/manage/${s}`};return(s,l)=>(o(),d("details",null,[n("summary",null,p(t.current.fname),1),n("div",P,[n("ul",J,[(o(!0),d(v,null,w(t.students,a=>(o(),d("li",{key:a.id_short,class:"name-list-li"},[n("a",{onClick:i=>e(a.id_short)},p(a.fname),9,R)]))),128))])])]))}}),_=t=>{if(t===void 0)return"";let e=new Date(t);return`${e.getMonth()+1}/${e.getDate()}/${e.getFullYear()}`},g=t=>{if(t===void 0)return"";let e=new Date(t);return`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`},V=(t,e,s)=>{const l=new Date(t).getTime();let i=new Date(e).getTime()-l,r=Math.ceil(i/1e3/60/60);return s*r},Y=["id"],z={class:"row-top"},G={key:0,class:"table-text check-table"},K={key:1,class:"table-text check-table"},Q={class:"table-text id-table"},W={class:"table-text date-table"},X={class:"table-text time-table class-in"},Z={class:"table-text time-table class-in"},ee={class:"table-text rate-table"},te={class:"table-text charge-table"},se={class:"table-text btn-table"},ne=["id"],ae={class:"table-input check-table-input"},ie=["id"],le=["id"],oe=["for"],de={class:"table-input date-table"},re=["id","value"],ce={class:"table-input time-table class-in"},ue=["id","value"],me={class:"table-input time-table class-in"},he=["id","value"],pe={class:"table-input rate-table"},be=["id","value"],fe={class:"table-input btn-table-input"},ge={name:"Session",props:{selected:{required:!1,default:!1,type:Boolean},paid:{required:!1,default:!1,type:Boolean},id:{required:!0,default:9999,unique:!0,type:Number},time_in:{required:!1,default:Date.now()-1e3*60*60,type:String},time_out:{required:!1,default:Date.now(),type:String},rate:{required:!0,default:65,type:Number}},components:[m],methods:{async editSession(){const t=document.getElementById(`${this.id}-paid`).checked,e=document.getElementById(`${this.id}-date`).value,s=document.getElementById(`${this.id}-intime`).value,l=document.getElementById(`${this.id}-outtime`).value,a=document.getElementById(`${this.id}-rate`).value;let i=new Date(e),r=this.parseTime(s),b=this.parseTime(l);r.setDate(i.getDate()),r.setMonth(i.getMonth()),r.setFullYear(i.getFullYear()),b.setDate(i.getDate()),b.setMonth(i.getMonth()),b.setFullYear(i.getFullYear()),await(await fetch("/api/sessions/update",{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({student:Number(localStorage.getItem("student")),number:this.id,paid:t,in_time:r,out_time:b,rate:a})})).json(),window.location.reload()},parseTime(t){const e=new Date,s=/^\d{1,2}\.\d{1,2}$/,l=/^\d{1,2}:\d{2}/,a=/^\d{3,4}$/;if(s.test(t)){let i=t.split(".");e.setHours(Number(i[0])),e.setMinutes(Number(i[1]))}else if(l.test(t)){let i=t.split(":");e.setHours(Number(i[0])),e.setMinutes(Number(i[1]))}else if(a.test(t)){let i=t.substring(t.length-2),r=t.substring(0,t.length-2);e.setHours(Number(r)),e.setMinutes(Number(i))}return e},async deleteSession(){const e=await(await fetch("/api/sessions/delete",{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({number:this.id,student:localStorage.getItem("student")})})).json();e.error?console.error(e.msg):window.location.reload()}}},$=Object.assign(ge,{emits:["selected"],setup(t,{emit:e}){const s=e,l=a=>{document.querySelector(`#details-${a}`).classList.toggle("hidden")};return(a,i)=>(o(),d("div",{id:`row-${t.id}`,class:F(`session-row ${t.paid?"":"unpaid"}`)},[n("div",z,[t.selected?(o(),d("span",G,[n("input",{type:"checkbox",checked:"",onChange:i[0]||(i[0]=r=>s("selected"))},null,32)])):(o(),d("span",K,[n("input",{type:"checkbox",unchecked:"",onChange:i[1]||(i[1]=r=>s("selected"))},null,32)])),n("span",Q,p(t.id),1),n("span",W,p(u(_)(t.time_in)),1),n("span",X,p(u(g)(t.time_in)),1),n("span",Z,p(u(g)(t.time_out)),1),n("span",ee,"$"+p(t.rate),1),n("span",te,"$"+p(u(V)(t.time_in,t.time_out,t.rate)),1),n("span",se,[c(m,{classes:"btn btn-manage",onClicked:i[2]||(i[2]=r=>l(t.id)),base:"pencil",alt:"caret-up"})])]),n("div",{id:`details-${t.id}`,class:"row-bottom hidden"},[n("span",ae,[t.paid?(o(),d("input",{key:0,type:"checkbox",id:`${t.id}-paid`,checked:""},null,8,ie)):(o(),d("input",{key:1,type:"checkbox",id:`${t.id}-paid`,unchecked:""},null,8,le)),n("label",{for:`${t.id}-paid`},"Paid",8,oe)]),n("span",de,[n("input",{type:"text",id:`${t.id}-date`,value:`${u(_)(t.time_in)}`},null,8,re)]),n("span",ce,[n("input",{type:"text",id:`${t.id}-intime`,value:`${u(g)(t.time_in)}`},null,8,ue)]),n("span",me,[n("input",{type:"text",id:`${t.id}-outtime`,value:`${u(g)(t.time_out)}`},null,8,he)]),n("span",pe,[n("input",{type:"text",id:`${t.id}-rate`,value:t.rate},null,8,be)]),n("span",fe,[c(m,{classes:"btn btn-add",onClicked:a.editSession,base:"save"},null,8,["onClicked"]),i[3]||(i[3]=f("   ")),c(m,{classes:"btn btn-del",onClicked:a.deleteSession,base:"minus"},null,8,["onClicked"])])],8,ne)],10,Y))}}),_e={class:"edit-name"},ke=["value"],ve=["value"],we={key:0,class:"table-text check-table"},ye={key:1,class:"table-text check-table"},Se={name:"NameMenu",props:{fname:{required:!0,default:"",type:String},lname:{required:!0,default:"",type:String},active:{required:!0,default:!0,type:Boolean}},components:{IconButton:m},methods:{saveClick:async()=>{const t=document.getElementById("fname").value,e=document.getElementById("lname").value,s=document.getElementById("active").checked;await(await fetch("/api/students/update",{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({id_short:localStorage.getItem("student"),fname:t,lname:e,active:s})})).json(),window.location.reload()}}},C=Object.assign(Se,{setup(t){return(e,s)=>(o(),d("div",_e,[s[2]||(s[2]=n("label",{for:"fname"},"Name",-1)),n("input",{type:"text",id:"fname",value:t.fname},null,8,ke),n("input",{type:"text",id:"lname",value:t.lname},null,8,ve),s[3]||(s[3]=n("label",{for:"active"},"Active",-1)),t.active?(o(),d("span",we,s[0]||(s[0]=[n("input",{type:"checkbox",id:"active",checked:""},null,-1)]))):(o(),d("span",ye,s[1]||(s[1]=[n("input",{type:"checkbox",id:"active",unchecked:""},null,-1)]))),c(m,{classes:"btn btn-save",onClicked:e.saveClick,base:"save"},null,8,["onClicked"])]))}}),$e={id:"main"},Ce={class:"tile"},Fe={class:"header-left"},De={class:"nav-back btn",href:"/landing"},je={class:"session-controls"},Ne={class:"date-range"},Ie=["value"],Ae=["value"],Be={id:"session-table"},Me={class:"table-header"},qe={class:"check-table"},Oe={class:"check-list"},Ee={class:"check-list-ul"},Te={class:"check-list-li"},xe={class:"check-list-li"},Ue={class:"check-list-li"},Le={class:"check-list-li"},Pe={class:"check-list-li"},Je={class:"row-container"},Re={name:"app",components:{StudentMenu:S,AuthMenu:y,Session:$,NameMenu:C,IconButton:m},async mounted(){this.setCurrent(),await this.getSessions(),await this.getStudents(),this.createDateFilter()},methods:{setCurrent(){const t=window.location.toString().split("/manage/");t.length===2&&localStorage.setItem("student",Number(t[1]))},async add_session(){const e=await(await fetch("/api/sessions/add",{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({student:Number(localStorage.getItem("student")),in_time:Date.now()-36e5,out_time:Date.now(),rate:65,paid:!1})})).json();if(console.log(e.data),e.error)window.alert(e.msg);else{let s=e.data;s.selected=!1,this.Sessions=[s,...this.Sessions],this.Filtered=[s,...this.Filtered]}},async getSessions(){const e=await(await fetch(`/api/sessions/read/${localStorage.getItem("student")}`)).json();e.error?console.log(e.msg):(this.Sessions=e.data,this.Filtered=e.data)},async getStudents(){const e=await(await fetch("/api/students/read")).json();e.error?console.log(e.msg):(this.AllStudents=e.data,this.CurrentStudent=e.data.filter(s=>s.id_short===Number(localStorage.getItem("student")))[0])},async get_invoice(){const t=await fetch("/api/sessions/invoice",{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({student:this.CurrentStudent,sessions:this.Filtered.filter(e=>e.selected).sort((e,s)=>e.number>s.number)})});if(t.status===200){const e=await t.blob(),s=window.URL.createObjectURL(e);let l=document.createElement("a");l.href=s,l.download=`${this.CurrentStudent.fname}_${this.CurrentStudent.lname}.pdf`,l.click(),window.URL.revokeObjectURL(s)}else{const e=await t.json();window.alert(e.msg)}},createDateFilter(){const t=this.Sessions[this.Sessions.length-1].in_time,e=this.Sessions[0].in_time;this.Dates={start:t,end:e}},filterDates(){const t=new Date(document.getElementById("date-start").value);let e=new Date(document.getElementById("date-end").value);e.setHours(23),e.setMinutes(59),this.Dates.start=t,this.Dates.end=e,this.Filtered=this.Filtered.filter(s=>new Date(s.in_time)>=t&&new Date(s.in_time)<=e)},resetDateFilter(){this.createDateFilter(),this.viewAllSessions()},viewAllSessions(){this.Filtered=this.Sessions},viewPaidSessions(){this.Filtered=this.Sessions.filter(t=>t.paid===!0)},viewUnpaidSessions(){this.Filtered=this.Sessions.filter(t=>t.paid===!1)},checkFiltered(){this.Filtered=this.Filtered.map(t=>(t.selected=!0,t))},uncheckFiltered(){this.Filtered=this.Filtered.map(t=>(t.selected=!1,t))},updateFiltered(t){this.Filtered=this.Filtered.map(e=>(e.number===t&&(e.selected=!e.selected),e))}},data(){return{Sessions:[],Filtered:[],AllStudents:[],CurrentStudent:{},Dates:{start:void 0,end:void 0}}}},He=Object.assign(Re,{setup(t){return(e,s)=>{const l=D("font-awesome-icon");return o(),d("main",$e,[n("div",Ce,[n("header",null,[n("span",Fe,[s[8]||(s[8]=n("a",{class:"screen-reader-only"},"Skip to Content",-1)),n("a",De,[c(l,{icon:"caret-left"}),s[7]||(s[7]=f(" Back"))])]),c(S,{current:e.CurrentStudent,students:e.AllStudents},null,8,["current","students"]),c(y)]),n("div",je,[c(m,{classes:"btn btn-invoice",onClicked:e.get_invoice,base:"print"},{default:k(()=>s[9]||(s[9]=[f(" Invoice")])),_:1,__:[9]},8,["onClicked"]),c(m,{classes:"btn btn-add-class",onClicked:e.add_session},{default:k(()=>s[10]||(s[10]=[f(" New Class")])),_:1,__:[10]},8,["onClicked"]),n("span",Ne,[n("input",{type:"text",id:"date-start",value:u(_)(e.Dates.start)},null,8,Ie),s[11]||(s[11]=f(" – ")),n("input",{type:"text",id:"date-end",value:u(_)(e.Dates.end)},null,8,Ae),n("button",{class:"btn btn-dates",onClick:s[0]||(s[0]=(...a)=>e.filterDates&&e.filterDates(...a))},"Filter"),n("button",{class:"btn btn-dates",onClick:s[1]||(s[1]=(...a)=>e.resetDateFilter&&e.resetDateFilter(...a))},"Reset")])]),n("div",Be,[n("div",Me,[n("span",qe,[n("details",null,[n("summary",null,[c(l,{icon:"list-check"})]),n("div",Oe,[n("ul",Ee,[n("li",Te,[n("a",{href:"#",onClick:s[2]||(s[2]=(...a)=>e.checkFiltered&&e.checkFiltered(...a))},"Check All")]),n("li",xe,[n("a",{href:"#",onClick:s[3]||(s[3]=(...a)=>e.uncheckFiltered&&e.uncheckFiltered(...a))},"Uncheck All")]),n("li",Ue,[n("a",{href:"#",onClick:s[4]||(s[4]=(...a)=>e.viewAllSessions&&e.viewAllSessions(...a))},"View All")]),n("li",Le,[n("a",{href:"#",onClick:s[5]||(s[5]=(...a)=>e.viewPaidSessions&&e.viewPaidSessions(...a))},"Paid")]),n("li",Pe,[n("a",{href:"#",onClick:s[6]||(s[6]=(...a)=>e.viewUnpaidSessions&&e.viewUnpaidSessions(...a))},"Unpaid")])])])])]),s[12]||(s[12]=j('<span class="table-text id-table">#</span><span class="table-text date-table">Date</span><span class="table-text time-table">In</span><span class="table-text time-table">Out</span><span class="table-text rate-table">Rate</span><span class="table-text charge-table">Charge</span><span class="table-text btn-table"></span>',7))]),n("div",Je,[(o(!0),d(v,null,w(e.Filtered,a=>(o(),N($,{key:a.number,selected:a.selected,paid:a.paid,id:a.number,time_in:a.in_time,time_out:a.out_time,rate:a.rate,onSelected:i=>e.updateFiltered(a.number)},null,8,["selected","paid","id","time_in","time_out","rate","onSelected"]))),128))])]),c(C,{fname:e.CurrentStudent.fname,lname:e.CurrentStudent.lname,active:e.CurrentStudent.active},null,8,["fname","lname","active"])])])}}});h.add(I);h.add(A);h.add(B);h.add(M);h.add(q);h.add(O);h.add(E);h.add(T);h.add(x);U(He).component("font-awesome-icon",L).mount("#app");
