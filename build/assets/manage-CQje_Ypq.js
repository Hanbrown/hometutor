import{c as r,o as d,a as n,t as b,F as w,r as $,_ as h,v as m,x as g,y,z as j,b as c,d as f,n as S,e as _,A as N,w as k,B as A,f as B,g as v,h as I,l as p,C as U,i as q,j as E,k as M,D as O,m as x,p as L,E as T,q as P,s as J,u as V}from"./index.es-a8uh0Ldj.js";/* empty css                   */const R={class:"name-list"},Y={class:"name-list-ul"},z=["onClick"],H={name:"StudentMenu",props:{students:{required:!0,default:[{fname:"Joost",id:9999}],type:Array},current:{required:!0,default:{fname:"Joost",id:9999},type:Object}}},C=Object.assign(H,{setup(e){const s=t=>{localStorage.setItem("student",t),window.location.href=`/manage/${t}`};return(t,i)=>(d(),r("details",null,[n("summary",null,b(e.current.fname),1),n("div",R,[n("ul",Y,[(d(!0),r(w,null,$(e.students,a=>(d(),r("li",{key:a.id_short,class:"name-list-li"},[n("a",{onClick:l=>s(a.id_short)},b(a.fname),9,z)]))),128))])])]))}}),G=["id"],W={class:"row-top"},K={key:0,class:"table-text check-table"},Q=["for"],X=["id"],Z={key:1,class:"table-text check-table"},ee=["for"],te=["id"],se={class:"table-text date-table"},ne={class:"table-text time-table class-in"},ae={class:"table-text time-table class-in"},ie={class:"table-text rate-table"},le={class:"table-text charge-table"},oe={class:"table-text btn-table"},de=["id"],re={class:"table-input check-table-input"},ce=["id"],ue=["id"],me=["for"],he={class:"table-input date-table"},pe=["id","value"],be={class:"table-input time-table class-in"},fe=["id","value"],ve={class:"table-input time-table class-in"},ye=["id","value"],ge={class:"table-input rate-table"},ke=["id","value"],we={class:"table-input btn-table-input"},$e={name:"Session",props:{selected:{required:!1,default:!1,type:Boolean},paid:{required:!1,default:!1,type:Boolean},id:{required:!0,default:9999,unique:!0,type:Number},time_in:{required:!1,default:Date.now()-1e3*60*60,type:String},time_out:{required:!1,default:Date.now(),type:String},rate:{required:!0,default:65,type:Number}},components:[h],methods:{async editSession(){const e=document.getElementById(`${this.id}-paid`).checked,s=document.getElementById(`${this.id}-date`).value,t=document.getElementById(`${this.id}-intime`).value,i=document.getElementById(`${this.id}-outtime`).value,a=document.getElementById(`${this.id}-rate`).value;let l=new Date(s),o=this.parseTime(t),u=this.parseTime(i);o.setDate(l.getDate()),o.setMonth(l.getMonth()),o.setFullYear(l.getFullYear()),u.setDate(l.getDate()),u.setMonth(l.getMonth()),u.setFullYear(l.getFullYear()),await(await fetch("/api/sessions/update",{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({student:Number(localStorage.getItem("student")),number:this.id,paid:e,in_time:o,out_time:u,rate:a})})).json(),window.location.reload()},parseTime(e){if(!/^\d{1,2}\S?\d{1,2}(\w{2})?$/.test(e))return new Date;const t=/\W/g;e=e.toLowerCase(),e=e.replaceAll(t,"");let i=!1,a=0;e.substring(e.length-2)==="am"?(i=!0,a=0,e=e.substring(0,e.length-2)):e.substring(e.length-2)==="pm"&&(i=!0,a=12,e=e.substring(0,e.length-2));let l,o;l=Number(e.substring(e.length-2)),o=Number(e.substring(0,e.length-2)),o>=24&&(i=!1),l=l%60,o=o%24,o<12&&i?o+=a:o===12&&i&&a===0&&(o=0);let u=new Date;return u.setHours(o),u.setMinutes(l),u.setSeconds(0),u},async deleteSession(){if(window.confirm("Delete this session?")){const s=await(await fetch("/api/sessions/delete",{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({number:this.id,student:localStorage.getItem("student")})})).json();s.error?console.error(s.msg):window.location.reload()}}}},F=Object.assign($e,{emits:["selected"],setup(e,{emit:s}){const t=s,i=a=>{document.querySelector(`#details-${a}`).classList.toggle("hidden")};return(a,l)=>(d(),r("div",{id:`row-${e.id}`,class:S(`session-row ${e.paid?"":"unpaid"}`)},[n("div",W,[e.selected?(d(),r("span",K,[n("label",{class:"screen-reader-only",for:`${e.id}-checkbox`},"Use in invoice",8,Q),n("input",{id:`${e.id}-checkbox`,type:"checkbox",checked:"",onChange:l[0]||(l[0]=o=>t("selected"))},null,40,X)])):(d(),r("span",Z,[n("label",{class:"screen-reader-only",for:`${e.id}-checkbox`},"Use in invoice",8,ee),n("input",{id:`${e.id}-checkbox`,type:"checkbox",unchecked:"",onChange:l[1]||(l[1]=o=>t("selected"))},null,40,te)])),l[3]||(l[3]=n("span",{class:"table-text id-table"}," ",-1)),n("span",se,b(m(g)(e.time_in)),1),n("span",ne,b(m(y)(e.time_in)),1),n("span",ae,b(m(y)(e.time_out)),1),n("span",ie,"$"+b(e.rate),1),n("span",le,"$"+b(m(j)(e.time_in,e.time_out,e.rate)),1),n("span",oe,[c(h,{classes:"btn btn-manage",label:"Manage this session",onClicked:l[2]||(l[2]=o=>i(e.id)),base:"pencil",alt:"caret-up"})])]),n("div",{id:`details-${e.id}`,class:"row-bottom hidden"},[n("span",re,[e.paid?(d(),r("input",{key:0,type:"checkbox",id:`${e.id}-paid`,checked:""},null,8,ce)):(d(),r("input",{key:1,type:"checkbox",id:`${e.id}-paid`,unchecked:""},null,8,ue)),n("label",{for:`${e.id}-paid`},"Paid",8,me)]),n("span",he,[n("input",{type:"text",id:`${e.id}-date`,value:`${m(g)(e.time_in)}`},null,8,pe)]),n("span",be,[n("input",{type:"text",id:`${e.id}-intime`,value:`${m(y)(e.time_in)}`},null,8,fe)]),n("span",ve,[n("input",{type:"text",id:`${e.id}-outtime`,value:`${m(y)(e.time_out)}`},null,8,ye)]),n("span",ge,[n("input",{type:"text",id:`${e.id}-rate`,value:e.rate},null,8,ke)]),n("span",we,[c(h,{classes:"btn btn-save",label:"Save changes",onClicked:a.editSession,base:"save"},null,8,["onClicked"]),l[4]||(l[4]=f("   ")),c(h,{classes:"btn btn-del",label:"Delete session",onClicked:a.deleteSession,base:"minus"},null,8,["onClicked"])])],8,de)],10,G))}}),Se={class:"edit-name"},_e=["value"],Ce=["value"],Fe=["value"],De={key:0},je={key:1},Ne={name:"NameMenu",props:{fname:{required:!0,default:"",type:String},lname:{required:!0,default:"",type:String},active:{required:!0,default:!0,type:Boolean},rate:{required:!0,default:60,type:Number}},components:{IconButton:h},methods:{saveClick:async()=>{const e=document.getElementById("fname").value,s=document.getElementById("lname").value,t=document.getElementById("active").checked,i=document.getElementById("rate-field").value;await fetch("/api/students/update",{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({id_short:localStorage.getItem("student"),fname:e,lname:s,active:t,rate:i})}),window.location.reload()}}},D=Object.assign(Ne,{setup(e){return(s,t)=>(d(),r("div",Se,[t[2]||(t[2]=n("label",{for:"fname",class:"screen-reader-only"},"First",-1)),n("input",{type:"text",id:"fname",value:e.fname},null,8,_e),t[3]||(t[3]=n("label",{for:"lname",class:"screen-reader-only"},"Last",-1)),n("input",{type:"text",id:"lname",value:e.lname},null,8,Ce),t[4]||(t[4]=n("label",{for:"rate-field",class:"screen-reader-only"},"Last",-1)),t[5]||(t[5]=n("label",null,"$",-1)),n("input",{type:"text",id:"rate-field",value:e.rate},null,8,Fe),t[6]||(t[6]=n("label",null,"/hour",-1)),e.active?(d(),r("span",De,t[0]||(t[0]=[n("label",{for:"active"},"Active",-1),n("input",{type:"checkbox",id:"active",checked:""},null,-1)]))):(d(),r("span",je,t[1]||(t[1]=[n("label",{for:"active"},"Active",-1),n("input",{type:"checkbox",id:"active",unchecked:""},null,-1)]))),c(h,{classes:"btn btn-save",onClicked:s.saveClick,base:"save"},null,8,["onClicked"])]))}}),Ae={id:"main"},Be={class:"tile"},Ie={class:"header-left"},Ue={class:"nav-back btn",href:"/landing"},qe={class:"session-controls"},Ee={class:"date-range"},Me=["value"],Oe=["value"],xe={id:"session-table"},Le={class:"table-header"},Te={class:"check-table"},Pe={class:"check-list"},Je={class:"check-list-ul"},Ve={class:"check-list-li"},Re={class:"check-list-li"},Ye={class:"check-list-li"},ze={class:"check-list-li"},He={class:"check-list-li"},Ge={class:"row-container"},We={key:0,class:S("session-row")},Ke={name:"app",components:{StudentMenu:C,AuthMenu:_,Session:F,NameMenu:D,IconButton:h},async mounted(){this.populateUser(),await this.getSessions(),await this.getStudents(),this.createDateFilter()},methods:{populateUser(){this.User={displayName:decodeURIComponent(v("displayName")),rate:v("rate")}},async add_session(){const s=await(await fetch("/api/sessions/add",{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({student:Number(v("student")),in_time:Date.now()-36e5,out_time:Date.now(),rate:this.CurrentStudent.rate,paid:!1})})).json();if(s.error)window.alert(s.msg);else{let t=s.data;t.selected=!1,this.Sessions=[t,...this.Sessions],this.Filtered=[t,...this.Filtered]}},async getSessions(){const s=await(await fetch(`/api/sessions/read/${v("student")}`)).json();s.error?console.log(s.msg):(this.Sessions=s.data,this.Filtered=s.data)},async getStudents(){const s=await(await fetch("/api/students/read")).json();s.error?console.log(s.msg):(this.AllStudents=s.data,this.CurrentStudent=s.data.filter(t=>t.id_short===Number(v("student")))[0])},async get_invoice(){const e=await fetch("/api/sessions/invoice",{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({student:this.CurrentStudent,sessions:this.Filtered.filter(s=>s.selected).sort((s,t)=>s.number>t.number)})});if(e.status===200){const s=await e.blob(),t=window.URL.createObjectURL(s);let i=document.createElement("a");i.href=t,i.download=`${this.CurrentStudent.fname}_${this.CurrentStudent.lname}.pdf`,i.click(),window.URL.revokeObjectURL(t)}else{const s=await e.json();window.alert(s.msg)}},createDateFilter(){if(this.Sessions.length>0){const e=this.Sessions[this.Sessions.length-1].in_time,s=this.Sessions[0].in_time;this.Dates={start:e,end:s}}},filterDates(){let e=document.getElementById("date-start").value,s=document.getElementById("date-end").value;e=this.parse_date(e),s=this.parse_date(s);let t,i;e==="invalid"?t=this.Dates.start:t=new Date(e),s==="invalid"?i=this.Dates.end:i=new Date(s),i.setHours(23),i.setMinutes(59),i<t?window.alert("End date cannot be earlier than start date"):(this.Dates.start=t,this.Dates.end=i,this.Filtered=this.Filtered.filter(a=>new Date(a.in_time)>=t&&new Date(a.in_time)<=i))},resetDateFilter(){this.createDateFilter(),this.viewAllSessions()},viewAllSessions(){this.Filtered=this.Sessions},viewPaidSessions(){this.Filtered=this.Sessions.filter(e=>e.paid===!0)},viewUnpaidSessions(){this.Filtered=this.Sessions.filter(e=>e.paid===!1)},checkFiltered(){this.Filtered=this.Filtered.map(e=>(e.selected=!0,e))},uncheckFiltered(){this.Filtered=this.Filtered.map(e=>(e.selected=!1,e))},updateFiltered(e){this.Filtered=this.Filtered.map(s=>(s.number===e&&(s.selected=!s.selected),s))},parse_date(e){const s=/^\d{1,2}\/\d{1,2}$/,t=/^\d{1,2}\/\d{1,2}\/(\d{2}|\d{4})$/;if(s.test(e)){let i=e.split("/"),a=new Date().getFullYear();return i.push(a.toString()),i.join("/")}else if(t.test(e))return e;return"invalid"}},data(){return{Sessions:[],Filtered:[],AllStudents:[],CurrentStudent:{},Dates:{start:void 0,end:void 0},User:{}}}},Qe=Object.assign(Ke,{setup(e){return(s,t)=>{const i=N("font-awesome-icon");return d(),r("main",Ae,[n("div",Be,[n("header",null,[n("span",Ie,[t[8]||(t[8]=n("a",{class:"screen-reader-only"},"Skip to Content",-1)),n("a",Ue,[c(i,{icon:"caret-left"}),t[7]||(t[7]=f(" Back"))])]),c(C,{current:s.CurrentStudent,students:s.AllStudents},null,8,["current","students"]),c(_,null,{default:k(()=>[f(b(s.User.displayName?s.User.displayName.split(" ")[0]:"Joost"),1)]),_:1})]),n("div",qe,[c(h,{classes:"btn btn-invoice",label:"Generate invoice",onClicked:s.get_invoice,base:"print"},{default:k(()=>t[9]||(t[9]=[f(" Invoice")])),_:1,__:[9]},8,["onClicked"]),c(h,{classes:"btn btn-add-class",label:"Add new class",onClicked:s.add_session},{default:k(()=>t[10]||(t[10]=[f(" New Class")])),_:1,__:[10]},8,["onClicked"]),n("span",Ee,[t[11]||(t[11]=n("label",{class:"screen-reader-only",for:"date-start"},"Date start",-1)),n("input",{type:"text",id:"date-start",value:m(g)(s.Dates.start)},null,8,Me),t[12]||(t[12]=f(" – ")),t[13]||(t[13]=n("label",{class:"screen-reader-only",for:"date-end"},"Date end",-1)),n("input",{type:"text",id:"date-end",value:m(g)(s.Dates.end)},null,8,Oe),n("button",{class:"btn btn-dates",onClick:t[0]||(t[0]=(...a)=>s.filterDates&&s.filterDates(...a))},"Filter"),n("button",{class:"btn btn-dates",onClick:t[1]||(t[1]=(...a)=>s.resetDateFilter&&s.resetDateFilter(...a))},"Reset")])]),n("div",xe,[n("div",Le,[n("span",Te,[n("details",null,[n("summary",null,[c(i,{icon:"print"}),t[14]||(t[14]=n("span",{class:"screen-reader-only"},"Filter sessions for invoice",-1))]),n("div",Pe,[n("ul",Je,[n("li",Ve,[n("a",{href:"#",onClick:t[2]||(t[2]=(...a)=>s.checkFiltered&&s.checkFiltered(...a))},"Check All")]),n("li",Re,[n("a",{href:"#",onClick:t[3]||(t[3]=(...a)=>s.uncheckFiltered&&s.uncheckFiltered(...a))},"Uncheck All")]),n("li",Ye,[n("a",{href:"#",onClick:t[4]||(t[4]=(...a)=>s.viewAllSessions&&s.viewAllSessions(...a))},"View All")]),n("li",ze,[n("a",{href:"#",onClick:t[5]||(t[5]=(...a)=>s.viewPaidSessions&&s.viewPaidSessions(...a))},"View Paid")]),n("li",He,[n("a",{href:"#",onClick:t[6]||(t[6]=(...a)=>s.viewUnpaidSessions&&s.viewUnpaidSessions(...a))},"View Unpaid")])]),t[15]||(t[15]=n("ul",{class:"check-list-ul"},[n("li",{class:"check-list-li"},[n("a",null,"Mark as Paid")]),n("li",{class:"check-list-li"},[n("a",null,"Mark as Unpaid")])],-1))])])]),t[16]||(t[16]=A('<span class="table-text id-table"> </span><span class="table-text date-table">Date</span><span class="table-text time-table">In</span><span class="table-text time-table">Out</span><span class="table-text rate-table">Rate</span><span class="table-text charge-table">Charge</span><span class="table-text btn-table"></span>',7))]),n("div",Ge,[(d(!0),r(w,null,$(s.Filtered,a=>(d(),I(F,{key:a.number,selected:a.selected,paid:a.paid,id:a.number,time_in:a.in_time,time_out:a.out_time,rate:a.rate,onSelected:l=>s.updateFiltered(a.number)},null,8,["selected","paid","id","time_in","time_out","rate","onSelected"]))),128)),s.Filtered.length===0?(d(),r("div",We,t[17]||(t[17]=[n("h5",{class:"table-text rate-table"},"No Classes, add one!",-1)]))):B("",!0)])]),c(D,{fname:s.CurrentStudent.fname,lname:s.CurrentStudent.lname,active:s.CurrentStudent.active,rate:s.CurrentStudent.rate},null,8,["fname","lname","active","rate"])])])}}});p.add(U);p.add(q);p.add(E);p.add(M);p.add(O);p.add(x);p.add(L);p.add(T);p.add(P);J(Qe).component("font-awesome-icon",V).mount("#app");
