import{c as r,o,a as n,t as b,F as $,r as _,_ as h,v as m,x as w,y,z as N,b as c,d as f,n as S,e as C,A,w as k,B,f as I,g as v,h as U,l as p,C as M,i as q,j as E,k as T,D as O,m as L,p as x,E as P,q as H,s as J,u as V}from"./index.es-Dg7itf3e.js";/* empty css                   */const R={class:"name-list"},Y={class:"name-list-ul"},W=["onClick"],z={name:"StudentMenu",props:{students:{required:!0,default:[{fname:"Joost",id:9999}],type:Array},current:{required:!0,default:{fname:"Joost",id:9999},type:Object}}},D=Object.assign(z,{setup(e){const s=t=>{localStorage.setItem("student",t),window.location.href=`/manage/${t}`};return(t,l)=>(o(),r("details",null,[n("summary",null,b(e.current.fname),1),n("div",R,[n("ul",Y,[(o(!0),r($,null,_(e.students,a=>(o(),r("li",{key:a.id_short,class:"name-list-li"},[n("a",{onClick:i=>s(a.id_short)},b(a.fname),9,W)]))),128))])])]))}}),G=["id"],K={class:"row-top"},Q={key:0,class:"table-text check-table"},X=["for"],Z=["id"],ee={key:1,class:"table-text check-table"},te=["for"],se=["id"],ne={class:"table-text date-table"},ae={class:"table-text time-table class-in"},ie={class:"table-text time-table class-in"},le={class:"table-text rate-table"},oe={class:"table-text charge-table"},de={class:"table-text btn-table"},re=["id"],ue={class:"table-input check-table-input"},ce=["id"],me=["id"],he=["for"],pe={class:"table-input date-table"},be=["id","value"],fe={class:"table-input time-table class-in"},ge=["id","value"],ve={class:"table-input time-table class-in"},ye=["id","value"],we={class:"table-input rate-table"},ke=["id","value"],$e={class:"table-input btn-table-input"},_e={name:"Session",props:{selected:{required:!1,default:!1,type:Boolean},paid:{required:!1,default:!1,type:Boolean},id:{required:!0,default:9999,unique:!0,type:Number},time_in:{required:!1,default:Date.now()-1e3*60*60,type:String},time_out:{required:!1,default:Date.now(),type:String},rate:{required:!0,default:65,type:Number}},components:[h],methods:{async editSession(){const e=document.getElementById(`${this.id}-paid`).checked,s=document.getElementById(`${this.id}-date`).value,t=document.getElementById(`${this.id}-intime`).value,l=document.getElementById(`${this.id}-outtime`).value,a=document.getElementById(`${this.id}-rate`).value;let i=new Date(s),u=this.parseTime(t),d=this.parseTime(l);u.setDate(i.getDate()),u.setMonth(i.getMonth()),u.setFullYear(i.getFullYear()),d.setDate(i.getDate()),d.setMonth(i.getMonth()),d.setFullYear(i.getFullYear()),await(await fetch("/api/sessions/update",{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({student:Number(localStorage.getItem("student")),number:this.id,paid:e,in_time:u,out_time:d,rate:a})})).json(),window.location.reload()},parseTime(e){const s=/^\d{1,2}\s?\w{2}$/,t=/^\d{1,2}\W?\d{1,2}\s?(\w{2})?$/;if(s.test(e)){const l=/\W/g;e=e.toLowerCase(),e=e.replaceAll(l,"");let a=new Date;if(e.substring(e.length-2)==="am"){let i=Number(e.substring(0,e.length-2));return i===12||i<0?a.setHours(0):i>12?a.setHours(i%12):a.setHours(i),a.setMinutes(0),a.setSeconds(0),a}else if(e.substring(e.length-2)==="pm"){let i=Number(e.substring(0,e.length-2));return i>12?a.setHours(i%12+12):i===12||i<=0?a.setHours(12):a.setHours(i+12),a.setMinutes(0),a.setSeconds(0),a}else return new Date}else if(t.test(e)){const l=/\W/g;e=e.toLowerCase(),e=e.replaceAll(l,"");let a=!1,i=0;e.substring(e.length-2)==="am"?(a=!0,i=0,e=e.substring(0,e.length-2)):e.substring(e.length-2)==="pm"&&(a=!0,i=12,e=e.substring(0,e.length-2));let u,d;u=Number(e.substring(e.length-2)),d=Number(e.substring(0,e.length-2)),d>=24&&(a=!1),u=u%60,d=d%24,d<12&&a?d+=i:d===12&&a&&i===0&&(d=0);let g=new Date;return g.setHours(d),g.setMinutes(u),g.setSeconds(0),g}else return new Date},async deleteSession(){if(window.confirm("Delete this session?")){const s=await(await fetch("/api/sessions/delete",{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({number:this.id,student:localStorage.getItem("student")})})).json();s.error?console.error(s.msg):window.location.reload()}}}},F=Object.assign(_e,{emits:["selected"],setup(e,{emit:s}){const t=s,l=a=>{document.querySelector(`#details-${a}`).classList.toggle("hidden")};return(a,i)=>(o(),r("div",{id:`row-${e.id}`,class:S(`session-row ${e.paid?"":"unpaid"}`)},[n("div",K,[e.selected?(o(),r("span",Q,[n("label",{class:"screen-reader-only",for:`${e.id}-checkbox`},"Use in invoice",8,X),n("input",{id:`${e.id}-checkbox`,type:"checkbox",checked:"",onChange:i[0]||(i[0]=u=>t("selected"))},null,40,Z)])):(o(),r("span",ee,[n("label",{class:"screen-reader-only",for:`${e.id}-checkbox`},"Use in invoice",8,te),n("input",{id:`${e.id}-checkbox`,type:"checkbox",unchecked:"",onChange:i[1]||(i[1]=u=>t("selected"))},null,40,se)])),i[3]||(i[3]=n("span",{class:"table-text id-table"}," ",-1)),n("span",ne,b(m(w)(e.time_in)),1),n("span",ae,b(m(y)(e.time_in)),1),n("span",ie,b(m(y)(e.time_out)),1),n("span",le,"$"+b(e.rate),1),n("span",oe,"$"+b(m(N)(e.time_in,e.time_out,e.rate)),1),n("span",de,[c(h,{classes:"btn btn-manage",label:"Manage this session",onClicked:i[2]||(i[2]=u=>l(e.id)),base:"pencil",alt:"caret-up"})])]),n("div",{id:`details-${e.id}`,class:"row-bottom hidden"},[n("span",ue,[e.paid?(o(),r("input",{key:0,type:"checkbox",id:`${e.id}-paid`,checked:""},null,8,ce)):(o(),r("input",{key:1,type:"checkbox",id:`${e.id}-paid`,unchecked:""},null,8,me)),n("label",{for:`${e.id}-paid`},"Paid",8,he)]),n("span",pe,[n("input",{type:"text",id:`${e.id}-date`,value:`${m(w)(e.time_in)}`},null,8,be)]),n("span",fe,[n("input",{type:"text",id:`${e.id}-intime`,value:`${m(y)(e.time_in)}`},null,8,ge)]),n("span",ve,[n("input",{type:"text",id:`${e.id}-outtime`,value:`${m(y)(e.time_out)}`},null,8,ye)]),n("span",we,[n("input",{type:"text",id:`${e.id}-rate`,value:e.rate},null,8,ke)]),n("span",$e,[c(h,{classes:"btn btn-save",label:"Save changes",onClicked:a.editSession,base:"save"},null,8,["onClicked"]),i[4]||(i[4]=f("   ")),c(h,{classes:"btn btn-del",label:"Delete session",onClicked:a.deleteSession,base:"minus"},null,8,["onClicked"])])],8,re)],10,G))}}),Se={class:"edit-name"},Ce=["value"],De=["value"],Fe=["value"],je={key:0},Ne={key:1},Ae={name:"NameMenu",props:{fname:{required:!0,default:"",type:String},lname:{required:!0,default:"",type:String},active:{required:!0,default:!0,type:Boolean},rate:{required:!0,default:60,type:Number}},components:{IconButton:h},methods:{saveClick:async()=>{const e=document.getElementById("fname").value,s=document.getElementById("lname").value,t=document.getElementById("active").checked,l=document.getElementById("rate-field").value;await fetch("/api/students/update",{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({id_short:localStorage.getItem("student"),fname:e,lname:s,active:t,rate:l})}),window.location.reload()}}},j=Object.assign(Ae,{setup(e){return(s,t)=>(o(),r("div",Se,[t[2]||(t[2]=n("label",{for:"fname",class:"screen-reader-only"},"First",-1)),n("input",{type:"text",id:"fname",value:e.fname},null,8,Ce),t[3]||(t[3]=n("label",{for:"lname",class:"screen-reader-only"},"Last",-1)),n("input",{type:"text",id:"lname",value:e.lname},null,8,De),t[4]||(t[4]=n("label",{for:"rate-field",class:"screen-reader-only"},"Last",-1)),t[5]||(t[5]=n("label",null,"$",-1)),n("input",{type:"text",id:"rate-field",value:e.rate},null,8,Fe),t[6]||(t[6]=n("label",null,"/hour",-1)),e.active?(o(),r("span",je,t[0]||(t[0]=[n("label",{for:"active"},"Active",-1),n("input",{type:"checkbox",id:"active",checked:""},null,-1)]))):(o(),r("span",Ne,t[1]||(t[1]=[n("label",{for:"active"},"Active",-1),n("input",{type:"checkbox",id:"active",unchecked:""},null,-1)]))),c(h,{classes:"btn btn-save",onClicked:s.saveClick,base:"save"},null,8,["onClicked"])]))}}),Be={id:"main"},Ie={class:"tile"},Ue={class:"header-left"},Me={class:"nav-back btn",href:"/landing"},qe={class:"session-controls"},Ee={class:"date-range"},Te=["value"],Oe=["value"],Le={id:"session-table"},xe={class:"table-header"},Pe={class:"check-table"},He={class:"check-list"},Je={class:"check-list-ul"},Ve={class:"check-list-li"},Re={class:"check-list-li"},Ye={class:"check-list-li"},We={class:"check-list-li"},ze={class:"check-list-li"},Ge={class:"row-container"},Ke={key:0,class:S("session-row")},Qe={name:"app",components:{StudentMenu:D,AuthMenu:C,Session:F,NameMenu:j,IconButton:h},async mounted(){this.populateUser(),await this.getSessions(),await this.getStudents(),this.createDateFilter()},methods:{populateUser(){this.User={displayName:decodeURIComponent(v("displayName")),rate:v("rate")}},async add_session(){const s=await(await fetch("/api/sessions/add",{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({student:Number(v("student")),in_time:Date.now()-36e5,out_time:Date.now(),rate:this.CurrentStudent.rate,paid:!1})})).json();if(s.error)window.alert(s.msg);else{let t=s.data;t.selected=!1,this.Sessions=[t,...this.Sessions],this.Filtered=[t,...this.Filtered]}},async getSessions(){const s=await(await fetch(`/api/sessions/read/${v("student")}`)).json();s.error?console.log(s.msg):(this.Sessions=s.data.sort((t,l)=>new Date(l.in_time).getTime()-new Date(t.in_time).getTime()),this.Filtered=s.data.sort((t,l)=>new Date(l.in_time).getTime()-new Date(t.in_time).getTime()))},async getStudents(){const s=await(await fetch("/api/students/read")).json();s.error?console.log(s.msg):(this.AllStudents=s.data,this.CurrentStudent=s.data.filter(t=>t.id_short===Number(v("student")))[0])},async get_invoice(){const e=await fetch("/api/sessions/invoice",{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({student:this.CurrentStudent,sessions:this.Filtered.filter(s=>s.selected).sort((s,t)=>s.number>t.number)})});if(e.status===200){const s=await e.blob(),t=window.URL.createObjectURL(s);let l=document.createElement("a");l.href=t,l.download=`${this.CurrentStudent.fname}_${this.CurrentStudent.lname}.pdf`,l.click(),window.URL.revokeObjectURL(t)}else{const s=await e.json();window.alert(s.msg)}},createDateFilter(){if(this.Sessions.length>0){const e=this.Sessions[this.Sessions.length-1].in_time,s=this.Sessions[0].in_time;this.Dates={start:e,end:s}}},filterDates(){let e=document.getElementById("date-start").value,s=document.getElementById("date-end").value;e=this.parse_date(e),s=this.parse_date(s);let t,l;e==="invalid"?t=this.Dates.start:t=new Date(e),s==="invalid"?l=this.Dates.end:l=new Date(s),l.setHours(23),l.setMinutes(59),l<t?window.alert("End date cannot be earlier than start date"):(this.Dates.start=t,this.Dates.end=l,this.Filtered=this.Filtered.filter(a=>new Date(a.in_time)>=t&&new Date(a.in_time)<=l))},resetDateFilter(){this.createDateFilter(),this.viewAllSessions()},viewAllSessions(){this.Filtered=this.Sessions},viewPaidSessions(){this.Filtered=this.Sessions.filter(e=>e.paid===!0)},viewUnpaidSessions(){this.Filtered=this.Sessions.filter(e=>e.paid===!1)},checkFiltered(){this.Filtered=this.Filtered.map(e=>(e.selected=!0,e))},uncheckFiltered(){this.Filtered=this.Filtered.map(e=>(e.selected=!1,e))},updateFiltered(e){this.Filtered=this.Filtered.map(s=>(s.number===e&&(s.selected=!s.selected),s))},parse_date(e){const s=/^\d{1,2}\/\d{1,2}$/,t=/^\d{1,2}\/\d{1,2}\/(\d{2}|\d{4})$/;if(s.test(e)){let l=e.split("/"),a=new Date().getFullYear();return l.push(a.toString()),l.join("/")}else if(t.test(e))return e;return"invalid"}},data(){return{Sessions:[],Filtered:[],AllStudents:[],CurrentStudent:{},Dates:{start:void 0,end:void 0},User:{}}}},Xe=Object.assign(Qe,{setup(e){return(s,t)=>{const l=A("font-awesome-icon");return o(),r("main",Be,[n("div",Ie,[n("header",null,[n("span",Ue,[t[8]||(t[8]=n("a",{class:"screen-reader-only"},"Skip to Content",-1)),n("a",Me,[c(l,{icon:"caret-left"}),t[7]||(t[7]=f(" Back"))])]),c(D,{current:s.CurrentStudent,students:s.AllStudents},null,8,["current","students"]),c(C,null,{default:k(()=>[f(b(s.User.displayName?s.User.displayName.split(" ")[0]:"Joost"),1)]),_:1})]),n("div",qe,[c(h,{classes:"btn btn-invoice",label:"Generate invoice",onClicked:s.get_invoice,base:"print"},{default:k(()=>t[9]||(t[9]=[f(" Invoice")])),_:1,__:[9]},8,["onClicked"]),c(h,{classes:"btn btn-add-class",label:"Add new class",onClicked:s.add_session},{default:k(()=>t[10]||(t[10]=[f(" New Class")])),_:1,__:[10]},8,["onClicked"]),n("span",Ee,[t[11]||(t[11]=n("label",{class:"screen-reader-only",for:"date-start"},"Date start",-1)),n("input",{type:"text",id:"date-start",value:m(w)(s.Dates.start)},null,8,Te),t[12]||(t[12]=f(" – ")),t[13]||(t[13]=n("label",{class:"screen-reader-only",for:"date-end"},"Date end",-1)),n("input",{type:"text",id:"date-end",value:m(w)(s.Dates.end)},null,8,Oe),n("button",{class:"btn btn-dates",onClick:t[0]||(t[0]=(...a)=>s.filterDates&&s.filterDates(...a))},"Filter"),n("button",{class:"btn btn-dates",onClick:t[1]||(t[1]=(...a)=>s.resetDateFilter&&s.resetDateFilter(...a))},"Reset")])]),n("div",Le,[n("div",xe,[n("span",Pe,[n("details",null,[n("summary",null,[c(l,{icon:"print"}),t[14]||(t[14]=n("span",{class:"screen-reader-only"},"Filter sessions for invoice",-1))]),n("div",He,[n("ul",Je,[n("li",Ve,[n("a",{href:"#",onClick:t[2]||(t[2]=(...a)=>s.checkFiltered&&s.checkFiltered(...a))},"Check All")]),n("li",Re,[n("a",{href:"#",onClick:t[3]||(t[3]=(...a)=>s.uncheckFiltered&&s.uncheckFiltered(...a))},"Uncheck All")]),n("li",Ye,[n("a",{href:"#",onClick:t[4]||(t[4]=(...a)=>s.viewAllSessions&&s.viewAllSessions(...a))},"View All")]),n("li",We,[n("a",{href:"#",onClick:t[5]||(t[5]=(...a)=>s.viewPaidSessions&&s.viewPaidSessions(...a))},"View Paid")]),n("li",ze,[n("a",{href:"#",onClick:t[6]||(t[6]=(...a)=>s.viewUnpaidSessions&&s.viewUnpaidSessions(...a))},"View Unpaid")])]),t[15]||(t[15]=n("ul",{class:"check-list-ul"},[n("li",{class:"check-list-li"},[n("a",null,"Mark as Paid")]),n("li",{class:"check-list-li"},[n("a",null,"Mark as Unpaid")])],-1))])])]),t[16]||(t[16]=B('<span class="table-text id-table"> </span><span class="table-text date-table">Date</span><span class="table-text time-table">In</span><span class="table-text time-table">Out</span><span class="table-text rate-table">Rate</span><span class="table-text charge-table">Charge</span><span class="table-text btn-table"></span>',7))]),n("div",Ge,[(o(!0),r($,null,_(s.Filtered,a=>(o(),U(F,{key:a.number,selected:a.selected,paid:a.paid,id:a.number,time_in:a.in_time,time_out:a.out_time,rate:a.rate,onSelected:i=>s.updateFiltered(a.number)},null,8,["selected","paid","id","time_in","time_out","rate","onSelected"]))),128)),s.Filtered.length===0?(o(),r("div",Ke,t[17]||(t[17]=[n("h5",{class:"table-text rate-table"},"No Classes, add one!",-1)]))):I("",!0)])]),c(j,{fname:s.CurrentStudent.fname,lname:s.CurrentStudent.lname,active:s.CurrentStudent.active,rate:s.CurrentStudent.rate},null,8,["fname","lname","active","rate"])])])}}});p.add(M);p.add(q);p.add(E);p.add(T);p.add(O);p.add(L);p.add(x);p.add(P);p.add(H);J(Xe).component("font-awesome-icon",V).mount("#app");
