import{c as d,o,b as s,t as p,F as v,i as w,a as S,_ as y,r as _,u as m,d as u,e as b,v as D,f as j,h as $,g as N,j as A,l as h,w as I,k as M,m as B,n as q,x as E,p as T,y as O,z as x,A as U,q as P,s as J}from"./index.es-CMVX562a.js";const L={class:"name-list"},H={class:"name-list-ul"},V=["onClick"],Y={name:"StudentMenu",props:{students:{required:!0,default:[{fname:"Joost",id:9999}],type:Array},current:{required:!0,default:{fname:"Joost",id:9999},type:Object}}},k=Object.assign(Y,{setup(t){const e=n=>{localStorage.setItem("student",n),window.location.href=`/manage/${n}`};return(n,l)=>(o(),d("details",null,[s("summary",null,p(t.current.fname),1),s("div",L,[s("ul",H,[(o(!0),d(v,null,w(t.students,i=>(o(),d("li",{key:i.id_short,class:"name-list-li"},[s("a",{onClick:a=>e(i.id_short)},p(i.fname),9,V)]))),128))])])]))}}),g=t=>{if(t===void 0)return"";let e=new Date(t);return`${e.getMonth()+1}/${e.getDate()}/${e.getFullYear()}`},f=t=>{if(t===void 0)return"";let e=new Date(t);return`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`},R=(t,e,n)=>{const l=new Date(t).getTime();let a=new Date(e).getTime()-l,r=Math.ceil(a/1e3/60/60);return n*r},z=["id"],G={class:"row-top"},K={key:0,class:"table-text check-table"},Q={key:1,class:"table-text check-table"},W={class:"table-text id-table"},X={class:"table-text date-table"},Z={class:"table-text time-table class-in"},ee={class:"table-text time-table class-in"},te={class:"table-text rate-table"},se={class:"table-text charge-table"},ne={class:"table-text btn-table"},ie=["id"],ae={class:"table-input check-table-input"},le=["id"],oe=["id"],de=["for"],re={class:"table-input date-table"},ce=["id","value"],ue={class:"table-input time-table class-in"},me=["id","value"],he={class:"table-input time-table class-in"},pe=["id","value"],fe={class:"table-input rate-table"},be=["id","value"],ge={class:"table-input btn-table-input"},_e={name:"Session",props:{selected:{required:!1,default:"false",type:String},paid:{required:!1,default:"false",type:String},id:{required:!0,default:9999,unique:!0,type:Number},time_in:{required:!1,default:Date.now()-1e3*60*60,type:Date},time_out:{required:!1,default:Date.now(),type:Date},rate:{required:!0,default:65,type:Number}},components:[S,y],methods:{async editSession(){const t=document.getElementById(`${this.id}-paid`).checked,e=document.getElementById(`${this.id}-date`).value,n=document.getElementById(`${this.id}-intime`).value,l=document.getElementById(`${this.id}-outtime`).value,i=document.getElementById(`${this.id}-rate`).value;let a=new Date(e),r=this.parseTime(n),c=this.parseTime(l);r.setDate(a.getDate()),r.setMonth(a.getMonth()),r.setFullYear(a.getFullYear()),c.setDate(a.getDate()),c.setMonth(a.getMonth()),c.setFullYear(a.getFullYear()),await(await fetch("/api/sessions/update",{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({student:Number(localStorage.getItem("student")),number:this.id,paid:t,in_time:r,out_time:c,rate:i})})).json(),window.location.reload()},parseTime(t){const e=new Date,n=/^\d{1,2}\.\d{1,2}$/,l=/^\d{1,2}:\d{2}/,i=/^\d{3,4}$/;if(n.test(t)){let a=t.split(".");e.setHours(Number(a[0])),e.setMinutes(Number(a[1]))}else if(l.test(t)){let a=t.split(":");e.setHours(Number(a[0])),e.setMinutes(Number(a[1]))}else if(i.test(t)){let a=t.substring(t.length-2),r=t.substring(0,t.length-2);e.setHours(Number(r)),e.setMinutes(Number(a))}return e},async deleteSession(){const e=await(await fetch("/api/sessions/delete",{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({number:this.id,student:localStorage.getItem("student")})})).json();e.error?console.error(e.msg):window.location.reload()}}},C=Object.assign(_e,{emits:["selected"],setup(t,{emit:e}){const n=e,l=i=>{document.querySelector(`#details-${i}`).classList.toggle("hidden")};return(i,a)=>{const r=_("font-awesome-icon");return o(),d("div",{id:`row-${t.id}`,class:D(`session-row ${t.paid?"":"unpaid"}`)},[s("div",G,[t.selected?(o(),d("span",K,[s("input",{type:"checkbox",checked:"",onChange:a[0]||(a[0]=c=>n("selected"))},null,32)])):(o(),d("span",Q,[s("input",{type:"checkbox",unchecked:"",onChange:a[1]||(a[1]=c=>n("selected"))},null,32)])),s("span",W,p(t.id),1),s("span",X,p(m(g)(t.time_in)),1),s("span",Z,p(m(f)(t.time_in)),1),s("span",ee,p(m(f)(t.time_out)),1),s("span",te,"$"+p(t.rate),1),s("span",se,"$"+p(m(R)(t.time_in,t.time_out,t.rate)),1),s("span",ne,[u(S,{onClicked:a[2]||(a[2]=c=>l(t.id)),should_switch:"true"})])]),s("div",{id:`details-${t.id}`,class:"row-bottom hidden"},[s("span",ae,[t.paid?(o(),d("input",{key:0,type:"checkbox",id:`${t.id}-paid`,checked:""},null,8,le)):(o(),d("input",{key:1,type:"checkbox",id:`${t.id}-paid`,unchecked:""},null,8,oe)),s("label",{for:`${t.id}-paid`},"Paid",8,de)]),s("span",re,[s("input",{type:"text",id:`${t.id}-date`,value:`${m(g)(t.time_in)}`},null,8,ce)]),s("span",ue,[s("input",{type:"text",id:`${t.id}-intime`,value:`${m(f)(t.time_in)}`},null,8,me)]),s("span",he,[s("input",{type:"text",id:`${t.id}-outtime`,value:`${m(f)(t.time_out)}`},null,8,pe)]),s("span",fe,[s("input",{type:"text",id:`${t.id}-rate`,value:t.rate},null,8,be)]),s("span",ge,[s("button",{class:"btn btn-add",onClick:a[3]||(a[3]=(...c)=>i.editSession&&i.editSession(...c))},[u(r,{icon:"save"})]),a[4]||(a[4]=b("   ")),u(y,{onClick:i.deleteSession},null,8,["onClick"])])],8,ie)],10,z)}}}),ve={name:"NameMenu",props:{fname:{required:!0,default:"",type:String},lname:{required:!0,default:"",type:String},active:{required:!0,default:!0,type:Boolean}},methods:{saveClick:async()=>{const t=document.getElementById("fname").value,e=document.getElementById("lname").value,n=document.getElementById("active").checked;await(await fetch("/api/students/update",{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({id_short:localStorage.getItem("student"),fname:t,lname:e,active:n})})).json(),window.location.reload()}}},we={class:"edit-name"},Se=["value"],ye=["value"],$e={key:0,class:"table-text check-table"},ke={key:1,class:"table-text check-table"};function Ce(t,e,n,l,i,a){const r=_("font-awesome-icon");return o(),d("div",we,[e[3]||(e[3]=s("label",{for:"fname"},"Name",-1)),s("input",{type:"text",id:"fname",value:n.fname},null,8,Se),s("input",{type:"text",id:"lname",value:n.lname},null,8,ye),e[4]||(e[4]=s("label",{for:"active"},"Active",-1)),n.active?(o(),d("span",$e,e[1]||(e[1]=[s("input",{type:"checkbox",id:"active",checked:""},null,-1)]))):(o(),d("span",ke,e[2]||(e[2]=[s("input",{type:"checkbox",id:"active",unchecked:""},null,-1)]))),s("button",{class:"btn btn-save",onClick:e[0]||(e[0]=c=>a.saveClick())},[u(r,{icon:"save"})])])}const F=j(ve,[["render",Ce]]),Fe={id:"main"},De={class:"tile"},je={class:"header-left"},Ne={class:"nav-back btn",href:"/"},Ae={class:"session-controls"},Ie={class:"date-range"},Me=["value"],Be=["value"],qe={id:"session-table"},Ee={class:"table-header"},Te={class:"check-table"},Oe={class:"check-list"},xe={class:"check-list-ul"},Ue={class:"check-list-li"},Pe={class:"check-list-li"},Je={class:"check-list-li"},Le={class:"check-list-li"},He={class:"check-list-li"},Ve={class:"row-container"},Ye={name:"app",components:{StudentMenu:k,AuthMenu:$,Session:C,NameMenu:F},async mounted(){this.setCurrent(),await this.getSessions(),await this.getStudents(),this.createDateFilter()},methods:{setCurrent(){const t=window.location.toString().split("/manage/");t.length===2&&localStorage.setItem("student",Number(t[1]))},async add_session(){const e=await(await fetch("/api/sessions/add",{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({student:Number(localStorage.getItem("student")),in_time:Date.now()-36e5,out_time:Date.now(),rate:65,paid:!1})})).json();if(console.log(e.data),e.error)window.alert(e.msg);else{let n=e.data;n.selected=!1,this.Sessions=[n,...this.Sessions],this.Filtered=[n,...this.Filtered]}},async getSessions(){const e=await(await fetch(`/api/sessions/read/${localStorage.getItem("student")}`)).json();e.error?console.log(e.msg):(this.Sessions=e.data,this.Filtered=e.data)},async getStudents(){const e=await(await fetch("/api/students/read")).json();e.error?console.log(e.msg):(this.AllStudents=e.data,this.CurrentStudent=e.data.filter(n=>n.id_short===Number(localStorage.getItem("student")))[0])},async get_invoice(){const t=await fetch("/api/sessions/invoice",{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({student:this.CurrentStudent,sessions:this.Filtered.filter(e=>e.selected).sort((e,n)=>e.number>n.number)})});if(t.status===200){const e=await t.blob(),n=window.URL.createObjectURL(e);let l=document.createElement("a");l.href=n,l.download=`${this.CurrentStudent.fname}_${this.CurrentStudent.lname}.pdf`,l.click()}else{const e=await t.json();window.alert(e.msg)}},createDateFilter(){const t=this.Sessions[this.Sessions.length-1].in_time,e=this.Sessions[0].in_time;this.Dates={start:t,end:e}},filterDates(){const t=new Date(document.getElementById("date-start").value);let e=new Date(document.getElementById("date-end").value);e.setHours(23),e.setMinutes(59),this.Dates.start=t,this.Dates.end=e,this.Filtered=this.Filtered.filter(n=>new Date(n.in_time)>=t&&new Date(n.in_time)<=e)},resetDateFilter(){this.createDateFilter(),this.viewAllSessions()},viewAllSessions(){this.Filtered=this.Sessions},viewPaidSessions(){this.Filtered=this.Sessions.filter(t=>t.paid===!0)},viewUnpaidSessions(){this.Filtered=this.Sessions.filter(t=>t.paid===!1)},checkFiltered(){this.Filtered=this.Filtered.map(t=>(t.selected=!0,t))},uncheckFiltered(){this.Filtered=this.Filtered.map(t=>(t.selected=!1,t))},updateFiltered(t){this.Filtered=this.Filtered.map(e=>(e.number===t&&(e.selected=!e.selected),e))}},data(){return{Sessions:[],Filtered:[],AllStudents:[],CurrentStudent:{},Dates:{start:void 0,end:void 0}}}},Re=Object.assign(Ye,{setup(t){return(e,n)=>{const l=_("font-awesome-icon");return o(),d("main",Fe,[s("div",De,[s("header",null,[s("span",je,[n[10]||(n[10]=s("a",{class:"screen-reader-only"},"Skip to Content",-1)),s("a",Ne,[u(l,{icon:"caret-left"}),n[9]||(n[9]=b(" Back"))])]),u(k,{current:e.CurrentStudent,students:e.AllStudents},null,8,["current","students"]),u($)]),s("div",Ae,[s("button",{class:"btn btn-invoice",onClick:n[0]||(n[0]=(...i)=>e.get_invoice&&e.get_invoice(...i))},[u(l,{icon:"print"}),n[11]||(n[11]=b(" Invoice"))]),s("button",{class:"btn btn-add-class",onClick:n[1]||(n[1]=(...i)=>e.add_session&&e.add_session(...i))},"New Class"),s("span",Ie,[s("input",{type:"text",id:"date-start",value:m(g)(e.Dates.start)},null,8,Me),n[12]||(n[12]=b(" – ")),s("input",{type:"text",id:"date-end",value:m(g)(e.Dates.end)},null,8,Be),s("button",{class:"btn btn-dates",onClick:n[2]||(n[2]=(...i)=>e.filterDates&&e.filterDates(...i))},"Filter"),s("button",{class:"btn btn-dates",onClick:n[3]||(n[3]=(...i)=>e.resetDateFilter&&e.resetDateFilter(...i))},"Reset")])]),s("div",qe,[s("div",Ee,[s("span",Te,[s("details",null,[s("summary",null,[u(l,{icon:"list-check"})]),s("div",Oe,[s("ul",xe,[s("li",Ue,[s("a",{href:"#",onClick:n[4]||(n[4]=(...i)=>e.checkFiltered&&e.checkFiltered(...i))},"Check All")]),s("li",Pe,[s("a",{href:"#",onClick:n[5]||(n[5]=(...i)=>e.uncheckFiltered&&e.uncheckFiltered(...i))},"Uncheck All")]),s("li",Je,[s("a",{href:"#",onClick:n[6]||(n[6]=(...i)=>e.viewAllSessions&&e.viewAllSessions(...i))},"View All")]),s("li",Le,[s("a",{href:"#",onClick:n[7]||(n[7]=(...i)=>e.viewPaidSessions&&e.viewPaidSessions(...i))},"Paid")]),s("li",He,[s("a",{href:"#",onClick:n[8]||(n[8]=(...i)=>e.viewUnpaidSessions&&e.viewUnpaidSessions(...i))},"Unpaid")])])])])]),n[13]||(n[13]=N('<span class="table-text id-table">#</span><span class="table-text date-table">Date</span><span class="table-text time-table">In</span><span class="table-text time-table">Out</span><span class="table-text rate-table">Rate</span><span class="table-text charge-table">Charge</span><span class="table-text btn-table"></span>',7))]),s("div",Ve,[(o(!0),d(v,null,w(e.Filtered,i=>(o(),A(C,{key:i.number,selected:i.selected,paid:i.paid,id:i.number,time_in:i.in_time,time_out:i.out_time,rate:i.rate,onSelected:a=>e.updateFiltered(i.number)},null,8,["selected","paid","id","time_in","time_out","rate","onSelected"]))),128))])]),u(F,{fname:e.CurrentStudent.fname,lname:e.CurrentStudent.lname,active:e.CurrentStudent.active},null,8,["fname","lname","active"])])])}}});h.add(I);h.add(M);h.add(B);h.add(q);h.add(E);h.add(T);h.add(O);h.add(x);h.add(U);P(Re).component("font-awesome-icon",J).mount("#app");
