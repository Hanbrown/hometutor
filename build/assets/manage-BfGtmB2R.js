import{c as r,o as d,a as n,t as h,F as k,i as w,_ as p,y as m,z as v,A as _,B as j,b as c,d as f,n as S,g,f as $,r as N,w as y,e as I,h as A,j as B,l as b,C as U,k as q,m as E,p as O,D as M,q as x,s as T,E as L,u as P,v as J,x as R}from"./index.es-DTR1JzKC.js";/* empty css                   */const V={class:"name-list"},Y={class:"name-list-ul"},z=["onClick"],H={name:"StudentMenu",props:{students:{required:!0,default:[{fname:"Joost",id:9999}],type:Array},current:{required:!0,default:{fname:"Joost",id:9999},type:Object}}},C=Object.assign(H,{setup(e){const t=s=>{localStorage.setItem("student",s),window.location.href=`/manage/${s}`};return(s,i)=>(d(),r("details",null,[n("summary",null,h(e.current.fname),1),n("div",V,[n("ul",Y,[(d(!0),r(k,null,w(e.students,a=>(d(),r("li",{key:a.id_short,class:"name-list-li"},[n("a",{onClick:l=>t(a.id_short)},h(a.fname),9,z)]))),128))])])]))}}),W=["id"],G={class:"row-top"},K={key:0,class:"table-text check-table"},Q={key:1,class:"table-text check-table"},X={class:"table-text id-table"},Z={class:"table-text date-table"},ee={class:"table-text time-table class-in"},te={class:"table-text time-table class-in"},se={class:"table-text rate-table"},ne={class:"table-text charge-table"},ae={class:"table-text btn-table"},ie=["id"],le={class:"table-input check-table-input"},oe=["id"],de=["id"],re=["for"],ce={class:"table-input date-table"},ue=["id","value"],me={class:"table-input time-table class-in"},he=["id","value"],pe={class:"table-input time-table class-in"},be=["id","value"],fe={class:"table-input rate-table"},ge=["id","value"],_e={class:"table-input btn-table-input"},ve={name:"Session",props:{selected:{required:!1,default:!1,type:Boolean},paid:{required:!1,default:!1,type:Boolean},id:{required:!0,default:9999,unique:!0,type:Number},time_in:{required:!1,default:Date.now()-1e3*60*60,type:String},time_out:{required:!1,default:Date.now(),type:String},rate:{required:!0,default:65,type:Number}},components:[p],methods:{async editSession(){const e=document.getElementById(`${this.id}-paid`).checked,t=document.getElementById(`${this.id}-date`).value,s=document.getElementById(`${this.id}-intime`).value,i=document.getElementById(`${this.id}-outtime`).value,a=document.getElementById(`${this.id}-rate`).value;let l=new Date(t),o=this.parseTime(s),u=this.parseTime(i);o.setDate(l.getDate()),o.setMonth(l.getMonth()),o.setFullYear(l.getFullYear()),u.setDate(l.getDate()),u.setMonth(l.getMonth()),u.setFullYear(l.getFullYear()),await(await fetch("/api/sessions/update",{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({student:Number(localStorage.getItem("student")),number:this.id,paid:e,in_time:o,out_time:u,rate:a})})).json(),window.location.reload()},parseTime(e){if(!/^\d{1,2}\S?\d{1,2}(\w{2})?$/.test(e))return new Date;const s=/\W/g;e=e.toLowerCase(),e=e.replaceAll(s,"");let i=!1,a=0;e.substring(e.length-2)==="am"?(i=!0,a=0,e=e.substring(0,e.length-2)):e.substring(e.length-2)==="pm"&&(i=!0,a=12,e=e.substring(0,e.length-2));let l,o;l=Number(e.substring(e.length-2)),o=Number(e.substring(0,e.length-2)),o>=24&&(i=!1),l=l%60,o=o%24,o<12&&i?o+=a:o===12&&i&&a===0&&(o=0);let u=new Date;return u.setHours(o),u.setMinutes(l),u.setSeconds(0),u},async deleteSession(){const t=await(await fetch("/api/sessions/delete",{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({number:this.id,student:localStorage.getItem("student")})})).json();t.error?console.error(t.msg):window.location.reload()}}},F=Object.assign(ve,{emits:["selected"],setup(e,{emit:t}){const s=t,i=a=>{document.querySelector(`#details-${a}`).classList.toggle("hidden")};return(a,l)=>(d(),r("div",{id:`row-${e.id}`,class:S(`session-row ${e.paid?"":"unpaid"}`)},[n("div",G,[e.selected?(d(),r("span",K,[n("input",{type:"checkbox",checked:"",onChange:l[0]||(l[0]=o=>s("selected"))},null,32)])):(d(),r("span",Q,[n("input",{type:"checkbox",unchecked:"",onChange:l[1]||(l[1]=o=>s("selected"))},null,32)])),n("span",X,h(e.id),1),n("span",Z,h(m(v)(e.time_in)),1),n("span",ee,h(m(_)(e.time_in)),1),n("span",te,h(m(_)(e.time_out)),1),n("span",se,"$"+h(e.rate),1),n("span",ne,"$"+h(m(j)(e.time_in,e.time_out,e.rate)),1),n("span",ae,[c(p,{classes:"btn btn-manage",onClicked:l[2]||(l[2]=o=>i(e.id)),base:"pencil",alt:"caret-up"})])]),n("div",{id:`details-${e.id}`,class:"row-bottom hidden"},[n("span",le,[e.paid?(d(),r("input",{key:0,type:"checkbox",id:`${e.id}-paid`,checked:""},null,8,oe)):(d(),r("input",{key:1,type:"checkbox",id:`${e.id}-paid`,unchecked:""},null,8,de)),n("label",{for:`${e.id}-paid`},"Paid",8,re)]),n("span",ce,[n("input",{type:"text",id:`${e.id}-date`,value:`${m(v)(e.time_in)}`},null,8,ue)]),n("span",me,[n("input",{type:"text",id:`${e.id}-intime`,value:`${m(_)(e.time_in)}`},null,8,he)]),n("span",pe,[n("input",{type:"text",id:`${e.id}-outtime`,value:`${m(_)(e.time_out)}`},null,8,be)]),n("span",fe,[n("input",{type:"text",id:`${e.id}-rate`,value:e.rate},null,8,ge)]),n("span",_e,[c(p,{classes:"btn btn-add",onClicked:a.editSession,base:"save"},null,8,["onClicked"]),l[3]||(l[3]=f("   ")),c(p,{classes:"btn btn-del",onClicked:a.deleteSession,base:"minus"},null,8,["onClicked"])])],8,ie)],10,W))}}),ye={class:"edit-name"},ke=["value"],we=["value"],Se={key:0,class:"table-text check-table"},$e={key:1,class:"table-text check-table"},Ce={name:"NameMenu",props:{fname:{required:!0,default:"",type:String},lname:{required:!0,default:"",type:String},active:{required:!0,default:!0,type:Boolean}},components:{IconButton:p},methods:{saveClick:async()=>{const e=document.getElementById("fname").value,t=document.getElementById("lname").value,s=document.getElementById("active").checked,i=g("user");await(await fetch("/api/students/update",{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({id_short:localStorage.getItem("student"),fname:e,lname:t,active:s,user:i})})).json(),window.location.reload()}}},D=Object.assign(Ce,{setup(e){return(t,s)=>(d(),r("div",ye,[s[2]||(s[2]=n("label",{for:"fname"},"Name",-1)),n("input",{type:"text",id:"fname",value:e.fname},null,8,ke),n("input",{type:"text",id:"lname",value:e.lname},null,8,we),s[3]||(s[3]=n("label",{for:"active"},"Active",-1)),e.active?(d(),r("span",Se,s[0]||(s[0]=[n("input",{type:"checkbox",id:"active",checked:""},null,-1)]))):(d(),r("span",$e,s[1]||(s[1]=[n("input",{type:"checkbox",id:"active",unchecked:""},null,-1)]))),c(p,{classes:"btn btn-save",onClicked:t.saveClick,base:"save"},null,8,["onClicked"])]))}}),Fe={id:"main"},De={class:"tile"},je={class:"header-left"},Ne={class:"nav-back btn",href:"/landing"},Ie={class:"session-controls"},Ae={class:"date-range"},Be=["value"],Ue=["value"],qe={id:"session-table"},Ee={class:"table-header"},Oe={class:"check-table"},Me={class:"check-list"},xe={class:"check-list-ul"},Te={class:"check-list-li"},Le={class:"check-list-li"},Pe={class:"check-list-li"},Je={class:"check-list-li"},Re={class:"check-list-li"},Ve={class:"row-container"},Ye={key:0,class:S("session-row")},ze={name:"app",components:{StudentMenu:C,AuthMenu:$,Session:F,NameMenu:D,IconButton:p},async mounted(){this.populateUser(),this.setCurrent(),await this.getSessions(),await this.getStudents(),this.createDateFilter()},methods:{populateUser(){this.User={user:g("user"),displayName:decodeURIComponent(g("displayName")),rate:g("rate")}},setCurrent(){const e=window.location.toString().split("/manage/");e.length===2&&localStorage.setItem("student",Number(e[1]))},async add_session(){const t=await(await fetch("/api/sessions/add",{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({student:Number(localStorage.getItem("student")),in_time:Date.now()-36e5,out_time:Date.now(),rate:65,paid:!1})})).json();if(console.log(t.data),t.error)window.alert(t.msg);else{let s=t.data;s.selected=!1,this.Sessions=[s,...this.Sessions],this.Filtered=[s,...this.Filtered]}},async getSessions(){g("user");const t=await(await fetch(`/api/sessions/read/${localStorage.getItem("student")}`)).json();t.error?console.log(t.msg):(this.Sessions=t.data,this.Filtered=t.data)},async getStudents(){const e=g("user"),s=await(await fetch(`/api/students/read/${e}`)).json();s.error?console.log(s.msg):(this.AllStudents=s.data,this.CurrentStudent=s.data.filter(i=>i.id_short===Number(localStorage.getItem("student")))[0])},async get_invoice(){const e=await fetch("/api/sessions/invoice",{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({student:this.CurrentStudent,sessions:this.Filtered.filter(t=>t.selected).sort((t,s)=>t.number>s.number)})});if(e.status===200){const t=await e.blob(),s=window.URL.createObjectURL(t);let i=document.createElement("a");i.href=s,i.download=`${this.CurrentStudent.fname}_${this.CurrentStudent.lname}.pdf`,i.click(),window.URL.revokeObjectURL(s)}else{const t=await e.json();window.alert(t.msg)}},createDateFilter(){const e=this.Sessions[this.Sessions.length-1].in_time,t=this.Sessions[0].in_time;this.Dates={start:e,end:t}},filterDates(){let e=document.getElementById("date-start").value,t=document.getElementById("date-end").value;e=this.parse_date(e),t=this.parse_date(t);let s,i;e==="invalid"?s=this.Dates.start:s=new Date(e),t==="invalid"?i=this.Dates.end:i=new Date(t),i.setHours(23),i.setMinutes(59),i<s?window.alert("End date cannot be earlier than start date"):(this.Dates.start=s,this.Dates.end=i,this.Filtered=this.Filtered.filter(a=>new Date(a.in_time)>=s&&new Date(a.in_time)<=i))},resetDateFilter(){this.createDateFilter(),this.viewAllSessions()},viewAllSessions(){this.Filtered=this.Sessions},viewPaidSessions(){this.Filtered=this.Sessions.filter(e=>e.paid===!0)},viewUnpaidSessions(){this.Filtered=this.Sessions.filter(e=>e.paid===!1)},checkFiltered(){this.Filtered=this.Filtered.map(e=>(e.selected=!0,e))},uncheckFiltered(){this.Filtered=this.Filtered.map(e=>(e.selected=!1,e))},updateFiltered(e){this.Filtered=this.Filtered.map(t=>(t.number===e&&(t.selected=!t.selected),t))},parse_date(e){const t=/^\d{1,2}\/\d{1,2}$/,s=/^\d{1,2}\/\d{1,2}\/(\d{2}|\d{4})$/;if(t.test(e)){let i=e.split("/"),a=new Date().getFullYear();return i.push(a.toString()),i.join("/")}else if(s.test(e))return e;return"invalid"}},data(){return{Sessions:[],Filtered:[],AllStudents:[],CurrentStudent:{},Dates:{start:void 0,end:void 0},User:{}}}},He=Object.assign(ze,{setup(e){return(t,s)=>{const i=N("font-awesome-icon");return d(),r("main",Fe,[n("div",De,[n("header",null,[n("span",je,[s[8]||(s[8]=n("a",{class:"screen-reader-only"},"Skip to Content",-1)),n("a",Ne,[c(i,{icon:"caret-left"}),s[7]||(s[7]=f(" Back"))])]),c(C,{current:t.CurrentStudent,students:t.AllStudents},null,8,["current","students"]),c($,null,{default:y(()=>[f(h(t.User.displayName.split(" ")[0]),1)]),_:1})]),n("div",Ie,[c(p,{classes:"btn btn-invoice",onClicked:t.get_invoice,base:"print"},{default:y(()=>s[9]||(s[9]=[f(" Invoice")])),_:1,__:[9]},8,["onClicked"]),c(p,{classes:"btn btn-add-class",onClicked:t.add_session},{default:y(()=>s[10]||(s[10]=[f(" New Class")])),_:1,__:[10]},8,["onClicked"]),n("span",Ae,[n("input",{type:"text",id:"date-start",value:m(v)(t.Dates.start)},null,8,Be),s[11]||(s[11]=f(" – ")),n("input",{type:"text",id:"date-end",value:m(v)(t.Dates.end)},null,8,Ue),n("button",{class:"btn btn-dates",onClick:s[0]||(s[0]=(...a)=>t.filterDates&&t.filterDates(...a))},"Filter"),n("button",{class:"btn btn-dates",onClick:s[1]||(s[1]=(...a)=>t.resetDateFilter&&t.resetDateFilter(...a))},"Reset")])]),n("div",qe,[n("div",Ee,[n("span",Oe,[n("details",null,[n("summary",null,[c(i,{icon:"print"})]),n("div",Me,[n("ul",xe,[n("li",Te,[n("a",{href:"#",onClick:s[2]||(s[2]=(...a)=>t.checkFiltered&&t.checkFiltered(...a))},"Check All")]),n("li",Le,[n("a",{href:"#",onClick:s[3]||(s[3]=(...a)=>t.uncheckFiltered&&t.uncheckFiltered(...a))},"Uncheck All")]),n("li",Pe,[n("a",{href:"#",onClick:s[4]||(s[4]=(...a)=>t.viewAllSessions&&t.viewAllSessions(...a))},"View All")]),n("li",Je,[n("a",{href:"#",onClick:s[5]||(s[5]=(...a)=>t.viewPaidSessions&&t.viewPaidSessions(...a))},"Paid")]),n("li",Re,[n("a",{href:"#",onClick:s[6]||(s[6]=(...a)=>t.viewUnpaidSessions&&t.viewUnpaidSessions(...a))},"Unpaid")])])])])]),s[12]||(s[12]=I('<span class="table-text id-table">#</span><span class="table-text date-table">Date</span><span class="table-text time-table">In</span><span class="table-text time-table">Out</span><span class="table-text rate-table">Rate</span><span class="table-text charge-table">Charge</span><span class="table-text btn-table"></span>',7))]),n("div",Ve,[(d(!0),r(k,null,w(t.Filtered,a=>(d(),B(F,{key:a.number,selected:a.selected,paid:a.paid,id:a.number,time_in:a.in_time,time_out:a.out_time,rate:a.rate,onSelected:l=>t.updateFiltered(a.number)},null,8,["selected","paid","id","time_in","time_out","rate","onSelected"]))),128)),t.Filtered.length===0?(d(),r("div",Ye,s[13]||(s[13]=[n("h5",{class:"table-text rate-table"},"No Classes, add one!",-1)]))):A("",!0)])]),c(D,{fname:t.CurrentStudent.fname,lname:t.CurrentStudent.lname,active:t.CurrentStudent.active},null,8,["fname","lname","active"])])])}}});b.add(U);b.add(q);b.add(E);b.add(O);b.add(M);b.add(x);b.add(T);b.add(L);b.add(P);J(He).component("font-awesome-icon",R).mount("#app");
